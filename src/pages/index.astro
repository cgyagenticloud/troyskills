---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const skills = await getCollection('skills');
const categories = [
  { id: 'P1', name: 'Prompt Injection', icon: 'üíâ', count: skills.filter(s => s.data.category === 'P1').length },
  { id: 'P2', name: 'Data Exfiltration', icon: 'üì§', count: skills.filter(s => s.data.category === 'P2').length },
  { id: 'P3', name: 'Privilege Escalation', icon: 'üîì', count: skills.filter(s => s.data.category === 'P3').length },
  { id: 'P4', name: 'Malicious Scripts', icon: 'üêç', count: skills.filter(s => s.data.category === 'P4').length },
  { id: 'P5', name: 'Config Tampering', icon: '‚öôÔ∏è', count: skills.filter(s => s.data.category === 'P5').length },
  { id: 'P6', name: 'Social Engineering', icon: 'üé≠', count: skills.filter(s => s.data.category === 'P6').length },
  { id: 'P7', name: 'Supply Chain', icon: 'üì¶', count: skills.filter(s => s.data.category === 'P7').length },
];
const recentSkills = skills.sort((a, b) => b.data.date.localeCompare(a.data.date)).slice(0, 5);
---

<Layout title="TroySkills ‚Äî AI Agent Malicious Skills Database">
  <!-- Hero -->
  <section class="max-w-6xl mx-auto px-4 py-20 text-center">
    <div class="inline-block px-3 py-1 bg-red-500/10 text-red-400 text-sm font-medium rounded-full mb-6 border border-red-500/20">
      ‚ö†Ô∏è AI Agent Security Database
    </div>
    <h1 class="text-5xl md:text-6xl font-extrabold mb-6 leading-tight">
      Know the <span class="text-red-500">threats</span>.<br />
      Protect your <span class="text-red-500">agents</span>.
    </h1>
    <p class="text-xl text-slate-400 max-w-2xl mx-auto mb-10">
      TroySkills is a public database of malicious AI agent skill patterns ‚Äî 
      like CVE/NVD, but built specifically for the AI agent ecosystem.
    </p>
    <div class="flex justify-center gap-4">
      <a href="/database" class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors">
        Browse Database ‚Üí
      </a>
      <a href="/about" class="px-6 py-3 bg-slate-800 hover:bg-slate-700 text-slate-200 font-semibold rounded-lg transition-colors">
        Learn More
      </a>
    </div>
  </section>

  <!-- Stats -->
  <section class="max-w-6xl mx-auto px-4 py-10">
    <div class="grid grid-cols-3 gap-6 text-center">
      <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
        <div class="text-3xl font-bold text-red-500">{skills.length}</div>
        <div class="text-slate-400 text-sm mt-1">Attack Patterns</div>
      </div>
      <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
        <div class="text-3xl font-bold text-red-500">7</div>
        <div class="text-slate-400 text-sm mt-1">Categories</div>
      </div>
      <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
        <div class="text-3xl font-bold text-red-500">{skills.filter(s => s.data.severity === 'Critical').length}</div>
        <div class="text-slate-400 text-sm mt-1">Critical Severity</div>
      </div>
    </div>
  </section>

  <!-- Categories -->
  <section class="max-w-6xl mx-auto px-4 py-10">
    <h2 class="text-2xl font-bold mb-6">Attack Categories</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      {categories.map(cat => (
        <a href={`/categories#${cat.id}`} class="bg-slate-900 border border-slate-800 rounded-xl p-5 hover:border-red-500/50 transition-colors">
          <div class="text-2xl mb-2">{cat.icon}</div>
          <div class="font-semibold">{cat.id}: {cat.name}</div>
          <div class="text-slate-500 text-sm">{cat.count} pattern{cat.count !== 1 ? 's' : ''}</div>
        </a>
      ))}
    </div>
  </section>

  <!-- Recent Entries -->
  <section class="max-w-6xl mx-auto px-4 py-10">
    <h2 class="text-2xl font-bold mb-6">Recent Entries</h2>
    <div class="space-y-3">
      {recentSkills.map(skill => (
        <a href={`/skill/${skill.data.id}`} class="block bg-slate-900 border border-slate-800 rounded-xl p-5 hover:border-red-500/50 transition-colors">
          <div class="flex items-center justify-between">
            <div>
              <span class="text-xs font-mono text-red-400 mr-3">{skill.data.id}</span>
              <span class="font-semibold">{skill.data.title}</span>
            </div>
            <div class="flex items-center gap-3">
              <span class={`text-xs px-2 py-1 rounded-full ${
                skill.data.severity === 'Critical' ? 'bg-red-500/20 text-red-400' :
                skill.data.severity === 'High' ? 'bg-orange-500/20 text-orange-400' :
                'bg-yellow-500/20 text-yellow-400'
              }`}>{skill.data.severity}</span>
              <span class="text-xs text-slate-500">{skill.data.category}</span>
            </div>
          </div>
          <p class="text-sm text-slate-400 mt-2">{skill.data.description}</p>
        </a>
      ))}
    </div>
  </section>
</Layout>
