---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const skills = await getCollection('skills');

const mitreMapping = [
  {
    category: 'P1',
    name: 'Prompt Injection',
    icon: 'üíâ',
    tactics: [
      { id: 'TA0001', name: 'Initial Access', url: 'https://attack.mitre.org/tactics/TA0001/' },
      { id: 'TA0002', name: 'Execution', url: 'https://attack.mitre.org/tactics/TA0002/' },
    ],
    rationale: 'Prompt injection serves as the initial access vector into an AI agent\'s decision space, analogous to spear-phishing in traditional attacks. Once injected, the attacker achieves arbitrary execution of instructions within the agent\'s context.',
    techniques: [
      { id: 'T1566', name: 'Phishing', url: 'https://attack.mitre.org/techniques/T1566/' },
      { id: 'T1059', name: 'Command and Scripting Interpreter', url: 'https://attack.mitre.org/techniques/T1059/' },
      { id: 'T1204', name: 'User Execution', url: 'https://attack.mitre.org/techniques/T1204/' },
    ],
  },
  {
    category: 'P2',
    name: 'Data Exfiltration',
    icon: 'üì§',
    tactics: [
      { id: 'TA0010', name: 'Exfiltration', url: 'https://attack.mitre.org/tactics/TA0010/' },
      { id: 'TA0009', name: 'Collection', url: 'https://attack.mitre.org/tactics/TA0009/' },
    ],
    rationale: 'AI agent data exfiltration mirrors traditional data theft but exploits the agent\'s privileged access to user data, API keys, and conversation history. Collection happens through the agent\'s own tool-calling capabilities.',
    techniques: [
      { id: 'T1041', name: 'Exfiltration Over C2 Channel', url: 'https://attack.mitre.org/techniques/T1041/' },
      { id: 'T1119', name: 'Automated Collection', url: 'https://attack.mitre.org/techniques/T1119/' },
      { id: 'T1530', name: 'Data from Cloud Storage', url: 'https://attack.mitre.org/techniques/T1530/' },
    ],
  },
  {
    category: 'P3',
    name: 'Privilege Escalation',
    icon: 'üîì',
    tactics: [
      { id: 'TA0004', name: 'Privilege Escalation', url: 'https://attack.mitre.org/tactics/TA0004/' },
    ],
    rationale: 'Skills that escalate an agent\'s permissions ‚Äî gaining access to filesystem, network, or admin APIs ‚Äî directly parallel traditional privilege escalation. The agent becomes a vehicle for vertical movement.',
    techniques: [
      { id: 'T1548', name: 'Abuse Elevation Control Mechanism', url: 'https://attack.mitre.org/techniques/T1548/' },
      { id: 'T1078', name: 'Valid Accounts', url: 'https://attack.mitre.org/techniques/T1078/' },
      { id: 'T1134', name: 'Access Token Manipulation', url: 'https://attack.mitre.org/techniques/T1134/' },
    ],
  },
  {
    category: 'P4',
    name: 'Malicious Scripts',
    icon: 'üêç',
    tactics: [
      { id: 'TA0002', name: 'Execution', url: 'https://attack.mitre.org/tactics/TA0002/' },
      { id: 'TA0003', name: 'Persistence', url: 'https://attack.mitre.org/tactics/TA0003/' },
    ],
    rationale: 'Malicious scripts executed through AI agent skills achieve code execution on the host system. When combined with installation hooks or scheduled tasks, they establish persistence ‚Äî surviving agent restarts.',
    techniques: [
      { id: 'T1059', name: 'Command and Scripting Interpreter', url: 'https://attack.mitre.org/techniques/T1059/' },
      { id: 'T1053', name: 'Scheduled Task/Job', url: 'https://attack.mitre.org/techniques/T1053/' },
      { id: 'T1547', name: 'Boot or Logon Autostart Execution', url: 'https://attack.mitre.org/techniques/T1547/' },
    ],
  },
  {
    category: 'P5',
    name: 'Config Tampering',
    icon: '‚öôÔ∏è',
    tactics: [
      { id: 'TA0003', name: 'Persistence', url: 'https://attack.mitre.org/tactics/TA0003/' },
      { id: 'TA0005', name: 'Defense Evasion', url: 'https://attack.mitre.org/tactics/TA0005/' },
    ],
    rationale: 'Modifying agent configuration files achieves persistence (the agent loads malicious settings on restart) and defense evasion (disabling logging, security checks, or sandboxing).',
    techniques: [
      { id: 'T1562', name: 'Impair Defenses', url: 'https://attack.mitre.org/techniques/T1562/' },
      { id: 'T1112', name: 'Modify Registry', url: 'https://attack.mitre.org/techniques/T1112/' },
      { id: 'T1222', name: 'File and Directory Permissions Modification', url: 'https://attack.mitre.org/techniques/T1222/' },
    ],
  },
  {
    category: 'P6',
    name: 'Social Engineering',
    icon: 'üé≠',
    tactics: [
      { id: 'TA0043', name: 'Reconnaissance', url: 'https://attack.mitre.org/tactics/TA0043/' },
    ],
    rationale: 'AI-powered social engineering uses agents to conduct reconnaissance and manipulate human users at scale. The agent becomes both the weapon and the delivery mechanism for social engineering attacks.',
    techniques: [
      { id: 'T1598', name: 'Phishing for Information', url: 'https://attack.mitre.org/techniques/T1598/' },
      { id: 'T1656', name: 'Impersonation', url: 'https://attack.mitre.org/techniques/T1656/' },
      { id: 'T1585', name: 'Establish Accounts', url: 'https://attack.mitre.org/techniques/T1585/' },
    ],
  },
  {
    category: 'P7',
    name: 'Supply Chain',
    icon: 'üì¶',
    tactics: [
      { id: 'TA0001', name: 'Initial Access', url: 'https://attack.mitre.org/tactics/TA0001/' },
    ],
    rationale: 'Compromised skill packages, poisoned registries, and malicious dependencies in the AI agent ecosystem directly parallel traditional software supply chain attacks ‚Äî the entry point is the trust relationship with the package source.',
    techniques: [
      { id: 'T1195', name: 'Supply Chain Compromise', url: 'https://attack.mitre.org/techniques/T1195/' },
      { id: 'T1199', name: 'Trusted Relationship', url: 'https://attack.mitre.org/techniques/T1199/' },
      { id: 'T1072', name: 'Software Deployment Tools', url: 'https://attack.mitre.org/techniques/T1072/' },
    ],
  },
];

const killChainStages = [
  { stage: 'Reconnaissance', icon: 'üîç', aiEquivalent: 'Skill marketplace scanning, agent capability enumeration', categories: ['P6'] },
  { stage: 'Weaponization', icon: '‚öíÔ∏è', aiEquivalent: 'Malicious skill creation, prompt payload crafting', categories: ['P1', 'P4'] },
  { stage: 'Delivery', icon: 'üìß', aiEquivalent: 'Skill package publishing, MCP server deployment', categories: ['P7'] },
  { stage: 'Exploitation', icon: 'üí•', aiEquivalent: 'Prompt injection execution, permission bypass', categories: ['P1', 'P3'] },
  { stage: 'Installation', icon: 'üì•', aiEquivalent: 'Config modification, persistent backdoor setup', categories: ['P4', 'P5'] },
  { stage: 'Command & Control', icon: 'üì°', aiEquivalent: 'Exfiltration channels, covert tool-call C2', categories: ['P2'] },
  { stage: 'Actions on Objectives', icon: 'üéØ', aiEquivalent: 'Data theft, social engineering, lateral movement', categories: ['P2', 'P6'] },
];
---

<Layout title="MITRE ATT&CK Mapping ‚Äî TroySkills">
  <main class="max-w-6xl mx-auto px-4 py-16">
    <!-- Header -->
    <div class="mb-12">
      <div class="inline-block px-3 py-1 bg-red-500/10 text-red-400 text-sm font-medium rounded-full mb-4 border border-red-500/20">
        üó∫Ô∏è Framework Mapping
      </div>
      <h1 class="text-4xl md:text-5xl font-extrabold mb-4">
        MITRE ATT&CK <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-orange-500">Mapping</span>
      </h1>
      <p class="text-lg text-slate-400 max-w-3xl">
        How TroySkills AI agent attack patterns map to the MITRE ATT&CK framework ‚Äî bridging 
        AI-specific threats with the industry-standard adversary taxonomy used by SOC teams worldwide.
      </p>
    </div>

    <!-- Why This Matters -->
    <section class="bg-slate-900/50 border border-slate-800 rounded-xl p-8 mb-12">
      <h2 class="text-2xl font-bold mb-4">Why Map AI Threats to ATT&CK?</h2>
      <div class="grid md:grid-cols-3 gap-6 text-sm text-slate-300">
        <div>
          <h3 class="text-white font-semibold mb-2">üîó Common Language</h3>
          <p>Security teams already speak ATT&CK. Mapping AI agent threats to familiar tactics means faster adoption, better tooling integration, and no new taxonomy to learn.</p>
        </div>
        <div>
          <h3 class="text-white font-semibold mb-2">üìä Risk Prioritization</h3>
          <p>ATT&CK-mapped threats can be fed directly into existing risk frameworks (NIST, ISO 27001) and SIEM detection rules ‚Äî making AI agent security measurable.</p>
        </div>
        <div>
          <h3 class="text-white font-semibold mb-2">üõ°Ô∏è Detection Engineering</h3>
          <p>Each mapping suggests detection opportunities: if P2 maps to Exfiltration (TA0010), existing DLP tools and network monitoring can be tuned for AI agent data leaks.</p>
        </div>
      </div>
    </section>

    <!-- Category ‚Üí Tactic Mapping Table -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold mb-6">Category ‚Üí Tactic Mapping</h2>
      <div class="space-y-6">
        {mitreMapping.map(m => {
          const catSkills = skills.filter(s => s.data.category === m.category);
          return (
            <div class="bg-slate-900/50 border border-slate-800 rounded-xl p-6">
              <div class="flex flex-wrap items-center gap-3 mb-3">
                <span class="text-2xl">{m.icon}</span>
                <h3 class="text-xl font-bold">{m.category}: {m.name}</h3>
                <span class="text-xs text-slate-500">({catSkills.length} patterns)</span>
                <span class="text-slate-600 mx-1">‚Üí</span>
                {m.tactics.map(t => (
                  <a href={t.url} target="_blank" rel="noopener noreferrer" class="px-2 py-0.5 bg-red-500/10 text-red-400 text-sm rounded border border-red-500/20 hover:bg-red-500/20 transition-colors">
                    {t.id}: {t.name} ‚Üó
                  </a>
                ))}
              </div>
              <p class="text-sm text-slate-400 mb-4">{m.rationale}</p>
              <div class="flex flex-wrap gap-2 mb-3">
                <span class="text-xs text-slate-500 font-medium">Related ATT&CK Techniques:</span>
                {m.techniques.map(t => (
                  <a href={t.url} target="_blank" rel="noopener noreferrer" class="text-xs px-2 py-0.5 bg-slate-800 text-slate-300 rounded hover:bg-slate-700 transition-colors">
                    {t.id} ‚Äî {t.name}
                  </a>
                ))}
              </div>
              <div class="flex flex-wrap gap-1">
                <span class="text-xs text-slate-500 font-medium mr-1">TroySkills:</span>
                {catSkills.slice(0, 8).map(s => (
                  <a href={`/skill/${s.data.id}`} class="text-xs px-1.5 py-0.5 bg-slate-800/50 text-slate-400 rounded hover:text-red-400 transition-colors">
                    {s.data.id}
                  </a>
                ))}
                {catSkills.length > 8 && <span class="text-xs text-slate-600">+{catSkills.length - 8} more</span>}
              </div>
            </div>
          );
        })}
      </div>
    </section>

    <!-- Cyber Kill Chain Mapping -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold mb-4">AI Agent Cyber Kill Chain</h2>
      <p class="text-slate-400 mb-8">How AI agent attacks map to the Lockheed Martin Cyber Kill Chain ‚Äî each stage has a direct analog in the agent ecosystem.</p>
      
      <div class="relative">
        <!-- Connection line -->
        <div class="absolute left-8 top-0 bottom-0 w-0.5 bg-gradient-to-b from-red-500/50 via-orange-500/50 to-red-500/50 hidden md:block"></div>
        
        <div class="space-y-4">
          {killChainStages.map((stage, i) => (
            <div class="relative flex gap-6 items-start">
              <div class="hidden md:flex flex-shrink-0 w-16 h-16 bg-slate-900 border border-slate-700 rounded-full items-center justify-center text-2xl z-10">
                {stage.icon}
              </div>
              <div class="flex-1 bg-slate-900/50 border border-slate-800 rounded-lg p-5">
                <div class="flex flex-wrap items-center gap-3 mb-2">
                  <span class="md:hidden text-xl">{stage.icon}</span>
                  <span class="text-xs text-slate-500 font-mono">STAGE {i + 1}</span>
                  <h3 class="font-bold text-lg">{stage.stage}</h3>
                </div>
                <p class="text-sm text-slate-400 mb-3">{stage.aiEquivalent}</p>
                <div class="flex gap-2">
                  {stage.categories.map(cat => {
                    const info = mitreMapping.find(m => m.category === cat);
                    return (
                      <a href={`/categories#${cat}`} class="text-xs px-2 py-0.5 bg-red-500/10 text-red-400 rounded border border-red-500/20 hover:bg-red-500/20 transition-colors">
                        {info?.icon} {cat}
                      </a>
                    );
                  })}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Summary Matrix -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold mb-6">Quick Reference Matrix</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm border-collapse">
          <thead>
            <tr class="border-b border-slate-700">
              <th class="text-left py-3 px-4 text-slate-400 font-medium">TroySkills Category</th>
              <th class="text-left py-3 px-4 text-slate-400 font-medium">MITRE Tactics</th>
              <th class="text-left py-3 px-4 text-slate-400 font-medium">Key Techniques</th>
              <th class="text-center py-3 px-4 text-slate-400 font-medium">Patterns</th>
            </tr>
          </thead>
          <tbody>
            {mitreMapping.map(m => (
              <tr class="border-b border-slate-800/50 hover:bg-slate-900/30">
                <td class="py-3 px-4 font-medium">
                  <a href={`/categories#${m.category}`} class="hover:text-red-400 transition-colors">
                    {m.icon} {m.category}: {m.name}
                  </a>
                </td>
                <td class="py-3 px-4">
                  {m.tactics.map(t => (
                    <a href={t.url} target="_blank" rel="noopener noreferrer" class="block text-red-400 hover:text-red-300">{t.name}</a>
                  ))}
                </td>
                <td class="py-3 px-4 text-slate-400">
                  {m.techniques.map(t => <span class="block">{t.id}</span>)}
                </td>
                <td class="py-3 px-4 text-center font-mono">
                  {skills.filter(s => s.data.category === m.category).length}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </section>

    <!-- CTA -->
    <div class="text-center bg-slate-900/50 border border-slate-800 rounded-xl p-8">
      <h2 class="text-xl font-bold mb-3">Use This Mapping</h2>
      <p class="text-slate-400 mb-6 max-w-xl mx-auto">
        Download the mapping data via our API, integrate with your SIEM, or use it to build AI-agent-aware detection rules.
      </p>
      <div class="flex justify-center gap-4 flex-wrap">
        <a href="/database" class="px-6 py-2.5 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors">
          Browse All Patterns
        </a>
        <a href="/api" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-200 font-semibold rounded-lg transition-colors border border-slate-700">
          API Access
        </a>
      </div>
    </div>
  </main>
</Layout>
