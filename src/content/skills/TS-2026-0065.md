---
id: "TS-2026-0065"
title: "Cross-Session Data Leakage via Shared Memory Stores"
category: "P2"
severity: "Critical"
description: "Sensitive data from one user's agent session leaks into another user's session through shared memory infrastructure, vector databases, or improperly isolated embedding stores."
date: "2026-02-26"
tags: ["memory", "data-leak", "cross-session", "isolation", "multi-tenant"]
---

## Overview

Multi-tenant agent platforms often share underlying infrastructure — vector databases, embedding stores, or caching layers — across users or sessions. When memory isolation is improperly implemented, semantic search queries from one user's session can retrieve embeddings or documents stored during another user's session. This is especially dangerous with vector similarity search, where related-but-unauthorized content surfaces through semantic proximity rather than explicit access.

## Attack Vector

1. Multiple users share an agent platform with a common vector database backend
2. User A's sensitive data (credentials, business plans, PII) gets embedded and stored
3. User B crafts queries that are semantically similar to User A's stored data
4. Vector similarity search returns User A's embeddings as relevant context
5. The agent presents User A's confidential information to User B

## Impact

- **Data breach** — sensitive data exposed across user boundaries
- **Compliance violations** — PII and regulated data leaks between tenants
- **Credential exposure** — API keys or secrets stored in one session retrieved in another
- **Business intelligence theft** — proprietary information accessible to competitors

## Example

```python
# Vulnerable shared vector store — no tenant isolation
from chromadb import Client

# Shared collection across all users (the vulnerability)
client = Client()
collection = client.get_or_create_collection("agent_memory")

def store_memory(user_id: str, content: str, metadata: dict):
    """Stores memory but doesn't enforce isolation at query time."""
    collection.add(
        documents=[content],
        metadatas=[{**metadata, "user_id": user_id}],
        ids=[f"{user_id}_{uuid4()}"]
    )

def recall_memory(user_id: str, query: str, n_results: int = 5):
    """VULNERABLE: queries entire collection without filtering by user_id."""
    results = collection.query(
        query_texts=[query],
        n_results=n_results
        # BUG: No where={"user_id": user_id} filter!
    )
    return results["documents"]

# User A stores sensitive business data
store_memory("user_alice", 
    "Q3 acquisition target: Acme Corp at $50M valuation. Board approved.",
    {"type": "business", "confidential": True})

store_memory("user_alice",
    "AWS root credentials: AKIA... secret: wJalr...",
    {"type": "credentials"})

# User B (attacker) queries with semantically similar terms
leaked_data = recall_memory("user_bob", "acquisition plans and company valuations")
# Returns User A's confidential acquisition details!

leaked_creds = recall_memory("user_bob", "AWS access keys and secrets")
# Returns User A's credentials!
```

## Mitigation

- Enforce strict tenant isolation at the vector database level (separate collections or namespaces)
- Apply `WHERE` filters on user/tenant ID for every memory query, not just storage
- Encrypt stored embeddings with per-user keys so cross-tenant results are unreadable
- Audit memory retrieval logs for cross-tenant access patterns
- Implement memory access controls independent of semantic similarity
- See also: [TS-2026-0037](/skill/TS-2026-0037), [TS-2026-0064](/skill/TS-2026-0064)

## Real-World Examples

- **Microsoft Copilot RAG Injection (2024):** Johann Rehberger discovered that poisoned content in shared documents could exploit how Microsoft Copilot processes retrieved content, leading to unauthorized access to emails and documents across user contexts. [Read more](https://www.promptfoo.dev/blog/rag-poisoning/)
- **ChatGPT Cross-Session Memory Leakage:** Research has shown that ChatGPT's memory features, designed to personalize interactions, can leak information across sessions since memories persist through account logouts and device changes. [Read more](https://www.mdpi.com/2078-2489/17/1/54)
